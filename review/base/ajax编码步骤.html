<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ajax</title>
</head>

<body>
    <script>
        // Ajax:
        // 是指一种创建交互式，快速动态网页应用的网页开发技术，无需重新加载整个网页的情况下，能够更新部分网页的技术
        // 通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。

        // new 操作符新建了一个空对象，这个对象原型指向构造函数的prototype，执行构造函数后返回这个对象。
        //ajax的优点，为什么用ajax

        // 1.无刷新，用户体验好
        // 2.使用XMLHttpRequest 本身传送的数据量很小（服务器响应回来的是部分数据，不是完整的页面），所以反应会更快，也就让网络程式更像一个桌面应用程序
        // 3.内部进行浏览器与服务器的数据交换，很多与服务器之间的沟通，完全是透过Javascript 来实行
        // 4.很多动作都是Javascript 来实行, 省去了网页重载的弊端



        // ajax的状态码
        // 0: 请求未初始化
        // 1: 已发送请求
        // 2: 已接收请求
        // 3: 请求处理中
        // 4: 请求完成并且已响应

        var type = "post";
        var url = "http://127.0.0.1:8082/detail";
        var async = true;
        var dataStr = "id=10010"

        //创建ajax的四个步骤
        // 创建ajax对象
        //创建异步对象XMLHttpRequest 的对象实例
        // XMLHttpRequest不支持跨域 仅支持同源策略（协议，ip，端口）
        //该对象的属性方法支持http服务环境下读取文档
        var xhr = new XMLHttpRequest();
        // 监听ajax对象请求的状态变化
        xhr.onreadystatechange = function () {
            // 请求状态码 等于 4 表示请求完成 
            if (xhr.readyState == 4) {
                // 响应的状态码 等于 200 表示响应成功  404  500 
                if (xhr.status == 200) {
                    // 响应报文（读取的内容数据）
                    var res = xhr.responseText;
                    console.log(res);
                    //
                    var res2 = JSON.parse(res);
                    console.log(res2);
                }
            }
            console.log(xhr.readyState, "=======", xhr.responseText)
        }

        //发起请求动作 与服务端建立联系
        // 建立服务连接
        xhr.open(type, url, async);

        // 发起请求
        // 如果请求方式为post ，那么需要设置请求头部信息
        if (type.toUpercase() == "POST") {
            //设置文档类型
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded")
        }
        //发送请求主体
        // 如果是get请求方式，此处填写null, 如果是post，填写提交的参数
        // username = admin & userpass=123123
        xhr.send(dataStr);


        //默写一遍？
        // var xhr = new XMLHttpRequest();
        // xhr.onreadystatechange = function () {
        //     if (xhr.readyState == 4) {
        //         //这类状态代码表明服务器成功地接受了客户端请求。
        //         // 　· 200 - OK 一切正常，对GET和POST请求的应答文档跟在后面。
        //         if (xhr.status == 200) {

        //             res = xhr.responseText;
        //             //json字符串转json对象
        //             var res2 = JSON.parse(res2);
        //         }
        //     }
        // }

        // open(type, url, async);
        // //
        // xhr.setRequestHeader("Content-type", "application-x-www-form-urlencoded")
        // send(datastr)

        // 1.Ajax：readyState（状态值）和status（状态码）的区别
        // readyState，是指运行AJAX所经历过的几种状态，无论访问是否成功都将响应的步骤，可以理解成为AJAX运行步骤，使用“ajax.readyState”获得
        // status，是指无论AJAX访问是否成功，由HTTP协议根据所提交的信息，服务器所返回的HTTP头信息代码，使用“ajax.status”获得
        // 总体理解：可以简单的理解为state代表一个整体的状态。而status是这个大的state下面具体的小的状态。

        // 2.什么是readyState
        // readyState是XMLHttpRequest对象的一个属性，用来标识当前XMLHttpRequest对象处于什么状态。
        // readyState总共有5个状态值，分别为0~4，每个值代表了不同的含义

        // 0：初始化，XMLHttpRequest对象还没有完成初始化
        // 1：载入，XMLHttpRequest对象开始发送请求
        // 2：载入完成，XMLHttpRequest对象的请求发送完成
        // 3：解析，XMLHttpRequest对象开始读取服务器的响应
        // 4：完成，XMLHttpRequest对象读取服务器响应结束
        // 3.什么是status
        // status是XMLHttpRequest对象的一个属性，表示响应的HTTP状态码
        // 在HTTP1.1协议下，HTTP状态码总共可分为5大类

        //20201015
        var xhr = new XMLHttpRequest();

        xhr.onreadystatechange = function () {

            if (xhr.readyState == 4) {
                if (xhr.status == 200) {
                    var req = xhr.responseText;
                    console.log("发送成功，响应成功！")
                }
            }

        }

        xhr.open(url, post, async);
        // xhr.open(url,type,async);
        //get 
        //post
        if (type.toUpperCase === "POST") {
            // xhr.setRequestHeader("Contant-Type","application/x-www-form/urlencoded")
        }
        xhr.setRequestHeader("", "application/x-www-form/urlencoded")

        xhr.send(null);//dataStr
    </script>
</body>

</html>